# 1장 계층형 아키택처의 문제는 무엇일까?

- 계층형 아키텍처는 견고한 아키텍처다.
- 하지만 코드에 나쁜 습관들이 스며들기 쉽다.
- 시간이 지날수록 점점 더 변경하기 어렵게 만드는 허점을 노출한다.

## 계층형 아키텍처는 데이터베이스 주도 설계를 유도한다

- 웹 -> 도메인 -> 영속성 계층으로 의존하기에 자연스레 데이터베이스에 의존하게 된다.
- 우리가 앱을 만들때는 상태보다는 행동을 중심으로 모델링한다.
- 비지니스 관점에서는 도메인로직을 먼저 만들고 이를 기반으로 영속성 게층과 웹계층을 만들어야 한다.
- 계층형 아키텍처에서는 의존성 방향에 따라 db를 먼저 만들고 이를 토대로 도메인 로직을 구현하곤 했을 것이다.
- 이는 ORM을 사용하기 때문이다. ORM은 비지니스 규칙을 영속성 관점과 섞고 싶은 유혹을 쉽게 받게 된다.
- 계층형 아키텍처에서는 도메인 계층에서 엔티티에 접근할 수 있기때문에 분명 사용하게 된다. 이렇게 도메인계층과 영속성계층에 강한 결합이 생긴다.

## 지름길을 택하기 쉬워진다

- 계층형 아키텍처에서 유일한 규칙은 특정계층에서는 같은 계층이나 아래 계층에만 접근가능하다는 것이다.
- 상위 계층에 위치한 컴포넌트에 접근해야하면 간단하게 컴포넌트 계층을 아래로 내리면 된다.
- 한번은 괜찮을지 모르겠지만 두번, 세번 이어지기 마련이다.
- 시간이 지나면 영속성 계층이 점점 비대해진다.

## 테스트하기 어려워진다

- 계층형 아키텍처에서 또하나의 변화는 계층을 건너뛰는 것이다.
- 간단한 작업이라는 이유로 웹계층에서 바로 영속성계층을 사용한다.
- 도메인 로직이 웹 계층으로 들어가고 점점 로직이 퍼져나간다.
- 웹 계층 테스트에서 영속성 계층의 모킹도 해야한다. 테스트가 점점 어려워지고 테스트를 하지 않게 된다.

## 유스케이스를 숨긴다

- 코드를 새로 작성하는 것보다 수정하는 것이 더 빈번하다.
- 여러가지 이유로 도메인 로직이 흩어지면 로직을 찾기 어려워진다.
- 넓어진 서비스도 로직을 찾기 어렵게 만들고 테스트도 어렵게 만든다.

## 동시작업이 어려워진다

- 여러명을 투입해 개발속도를 높이기 위해서는 동시작업이 가능해야한다.
- 계층형 아키텍처에서는 이렇게 작업할 수 없다. 영속성 계층을 먼저 개발하고 이후에 도메인, 웹 계층을 개발해야해 특정기능은 한명만 개발할 수 있다.
- 넓은 서비스가 있다면 더 문제다. 충돌이 발생하고 병합에 시간이 걸리고 롤백을 하게 될 수도 있다.

## 유지보수 가능한 소프트웨어를 만드는데 어떻게 도움이 될까?

- 올바르게 구축하고 몇가지 규칙을 추가하면 계층형 아키텍처도 유지보수하기 쉽고 변경/추가가 쉬워진다.
- 그러나 계층형 아키텍처는 잘못된 방향으로 가도록 용인한다.
- 이 함정을 염두에 두면 지름길을 택하지 않고 유지보수하기 쉬운 솔루션을 만드는데 도움이 될 것이다.
