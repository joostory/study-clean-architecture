# 웹 어댑터 구현하기

## 의존성 역전

- adapter.in.web -> application.port.in - application.service
- 인커밍 어댑터는 외부요청을 받아 어플리케이션 내부의 코어를 호출, 어플리케이션은 통신을 위한 포트를 제공
- 의존성 역전을 하지 않고 바로 인커밍 어댑터가 서비스를 호출할 수도 있다.
- 하지만 포트는 외부와의 어떤 통신이 일어나는지 알려주는 소중한 정보다.
- 웹소켓의 경우는 인커밍 어댑터가 아웃고잉 어댑터의 역할도 할 수 있다.

## 웹 어댑터의 책임

1. HTTP 요청을 자바객체로 매핑
    - RequestBody, RequestParam
2. 권한검사
    - Security, Intercepter
3. 입력 유효성 검증
    - Valid
    - 입력모델을 유스케이스모델로 변환이 가능함을 검증
4. 입력을 유스케이스의 입력모델로 매핑
    - RequestParam -> UseCaseCommand
5. 유스케이스 호출
6. 유스케이스의 출력을 HTTP로 매핑
    - 발생한 Exception, 응답을 HTTP응답으로 매핑
7. HTTP응답을 반환

- 웹 어댑터의 책임이 많다. 하지만 어쩔 수 없다.
- 그렇다고 하더라도 이 책임을 애플리케이션 계층에서 하면 안된다. HTTP를 사용하지 않는 또다른 인커밍 어댑터가 요청을 하지 못하기 때문이다.

## 컨트롤러 나누기

- 하나의 컨트롤러가 모든 요청에 응답해도 되지만 같은 패키지의 여러 클래스로 구성해도 된다.
- 너무 적은 것보다는 너무 많은 게 낫다.
- 컨트롤러가 크면 테스트 코드도 커진다. 크기가 작을수록 찾기가 쉬워진다.
- 각 연산이 별도의 컨트롤러로 있는 편이 좋다고 생각

